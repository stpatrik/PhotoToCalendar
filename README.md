# PhotoToCalendar

iOS-приложение на SwiftUI, которое превращает фотографию/скрин расписания в события Календаря. Приложение распознаёт текст (Vision), извлекает пары времени (например, `08:30–10:00`), название предмета, преподавателя, аудиторию, чётность недели и подгруппу, а затем создаёт повторяющиеся события через EventKit. Опционально добавляет адрес кампуса и напоминание «пора выходить» с расчётом пути (MapKit).

## Возможности

- Импорт изображения:
  - Фото с камеры
  - Выбор из Фотопленки (PhotosUI)
- OCR (Vision) с учётом расположения строк:
  - Сортировка строк по «дорожкам»/строкам таблицы
  - Нормализация символов (`–`/`—` → `-`)
- Парсинг расписания:
  - Время начала/конца пары
  - Название занятия, преподаватель, аудитория
  - День недели, чёт/неч неделя, подгруппа
  - Режимы импорта: один день, неделя, «до конца семестра»
- Импорт в Календарь (EventKit):
  - Создание отдельного календаря «Расписание»
  - Еженедельные/двухнедельные повторения
  - Структурированный адрес (EKStructuredLocation)
  - Будильник «время выхода» по ETA (пешком/общ. транспорт)
- Настройки:
  - Адрес кампуса
  - Транспорт по умолчанию (пешком/общественный)
  - Дата окончания семестра
  - Подгруппа по умолчанию / спрашивать при импорте

## Как это работает

1. Пользователь делает фото или выбирает изображение расписания.
2. `TextRecognitionService` (Vision) извлекает строки с координатами.
3. `ScheduleParser` группирует строки по горизонтальным «полосам» и определяет поля (время, предмет, преп., аудитория, чётность, день, подгруппа). Есть запасной парсер на основе чистого текста.
4. `CalendarService` создаёт (или находит) календарь «Расписание», формирует повторяющиеся события, добавляет адрес кампуса и будильник «Time to leave».
5. `TravelTimeService` (MapKit) оценивает время в пути и прибавляет буфер.

## Требования

- Xcode 16+
- iOS 18.6+ (минимальная версия берётся из проекта)
- SwiftUI, PhotosUI, Vision, EventKit, MapKit

## Сборка и запуск

1. Открой `PhotoToCalendar.xcodeproj` в Xcode.
2. В `Signing & Capabilities` укажи свой Team и Bundle Identifier.
3. Убедись, что у таргета включены нужные возможности/разрешения:
   - Calendars (Events) — доступ к календарям
   - Location When In Use — для оценки времени выхода (ETA)
4. Запусти на устройстве (для камеры/Фотопленки и ETA нужен реальный девайс).

## Разрешения (Info.plist)

Добавь (или проверь) ключи с понятными описаниями:
- `NSCameraUsageDescription` — доступ к камере для снимка расписания
- `NSPhotoLibraryAddUsageDescription` / `NSPhotoLibraryUsageDescription` — выбор фото из медиатеки
- `NSCalendarsUsageDescription` — создание событий расписания
- `NSLocationWhenInUseUsageDescription` — оценка времени выхода до кампуса

## Использование

1. Нажми «Камера» или выбери фото расписания.
2. Нажми «Распознать» — появится распознанный текст.
3. Нажми «Разобрать» — увидишь список пар с полями (время, предмет, преп., аудитория и т. д.).
4. В разделе «Импорт» выбери режим:
   - Один день: укажи дату
   - Неделя: укажи понедельник недели
   - До конца семестра: включи тумблер и выбери дату окончания
5. Укажи транспорт и адрес кампуса (для напоминания «пора выходить»).
6. Нажми «Импортировать в Календарь».

После импорта будет показана сводка: сколько событий добавлено, сколько пропущено (например, дубли).

## Структура проекта

```
PhotoToCalendar/
  PhotoToCalendar/
    Assets.xcassets/
      AppIcon.appiconset/
      AccentColor.colorset/
    Localization/                   # (если добавишь строки/локализации)
    Models /
      ScheduleModels.swift          # OCRLine, ScheduleItem, ImportResult и др.
    Services/
      CalendarService.swift         # Работа с EventKit, повторения, локация, ETA
      LocationService.swift         # Запрос текущей локации (при необходимости)
      ScheduleParser.swift          # Парсинг строк/позиции в расписание
      TextRecognitionService.swift  # Vision OCR (строки + позиции)
      TravelTimeService.swift       # Расчёт ETA (MapKit)
    Settings/
      SettingsStorage.swift         # @AppStorage настройки
    UI/
      CameraView.swift              # Захват фото
      PhotoPickerView.swift         # Выбор из Фотопленки
    Utilities/
      DateParsing.swift             # Утилиты дат (след. рабочий день, понедельник и т. п.)
    ContentView.swift               # Экран формы: импорт → распознать → разобрать → импортировать
    PhotoToCalendarApp.swift        # Точка входа SwiftUI
  PhotoToCalendar.xcodeproj/
```

## Известные ограничения

- Качество OCR зависит от чёткости фото и верстки таблицы.
- Не все шаблоны расписаний одинаковы: может понадобиться корректировать эвристики парсера (регэкспы преподавателей/аудиторий/чётности).
- ETA и напоминание «пора выходить» требуют адреса кампуса и геолокации; без координат используется дефолтный буфер.

## Доработки и идеи

- Локализации интерфейса (RU/EN/DE).
- Поддержка экспорта в .ics.
- Ручное редактирование распознанных пар до импорта.
- Улучшение эвристик определения дня недели и подгруппы.
- История последних импортов/откат.

## Автор

Georgy (2025)
